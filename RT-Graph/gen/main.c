// SPDX-FileCopyrightText: 2024 Cesanta Software Limited
// SPDX-License-Identifier: GPL-2.0-only or commercial
// Generated by Mongoose Wizard, https://mongoose.ws/wizard/

#include "mongoose_glue.h"

void wifi_setconfig(void *data) {
  struct mg_tcpip_driver_pico_w_data *d = (struct mg_tcpip_driver_pico_w_data *) data;
  struct mg_wifi_data *wifi = &d->wifi;
  wifi->ssid = WIZARD_WIFI_NAME;
  wifi->pass = WIZARD_WIFI_PASS;
  wifi->apssid = WIZARD_WIFI_AP_NAME;
  wifi->appass = WIZARD_WIFI_AP_PASS;
  wifi->apip = MG_IPV4(192, 168, 111, 1);
  wifi->apmask = MG_IPV4(255, 255, 255, 0);
  wifi->security = 0;
  wifi->apsecurity = 0;
  wifi->apchannel = 10;
  wifi->apmode = WIZARD_ENABLE_WIFI_AP;
}

static void blink_timer(void *arg) {
  (void) arg;
  cyw43_arch_gpio_put(CYW43_WL_GPIO_LED_PIN, !cyw43_arch_gpio_get(CYW43_WL_GPIO_LED_PIN));
}

int main(void) {
  stdio_init_all();
  // do not access the CYW43 LED before Mongoose initializes !
  MG_INFO(("Hardware initialised, starting firmware..."));
  // This blocks forever. Call it at the end of main()
  mongoose_init();
  mg_timer_add(&g_mgr, 1000, MG_TIMER_REPEAT, blink_timer, NULL);
  for (;;) {
    mongoose_poll();
  }

  return 0;
}
